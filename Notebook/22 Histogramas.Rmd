---
title: "22.- Histogramas"
author: "Daniel"
date: "05-12-2019"
output: html_document
---

# Histogramas

La mejor manera de representar datos agrupados es mediante unos diagramas de barras especiales conocidos como **histogramas**.

En ellos se dibuja sobre cada clase una barra cuya área representa su frecuencia. Podéis comprobar que el producto de la base por la altura de cada barra es igual a la frecuencia de sus clase correspondiente.

## El uso de histogramas 

Si todas las clases tienen la misma amplitud, las alturas de estas barras son propocionales a las frecuencias de sus clases, con lo cual podemos marcar sin ningún problema las frecuencias sobre el eje vertical. Pero si las amplitudes de las clases no son iguales, las alturas de las barras en un histograma no representan correctamente las frecuencias de las clases.

En este caso, las alturas de la barra son necesarias para que el área de cada barra sea igual a la frecuencia de la clase correspondiente y como las bases son de amplitudes diferentes, estas alturas no son proporcionales a las frecuencias de las clases, por lo que no tiene sentido marcar las frecuencias en el eje vertical.

Los histogramas también son utilizados para representar frecuencias acumuladas de datos agrupados. En este caso, las alaturas representan las frecuencias independientes de la base debido a que estas deben ir creciendo.

## Interpretación de los histogramas

El eje de las abcisas representa los datos. Aquí marcamos los extremos de las clases y se dibuja una barra sobre cada una de ellas. Esta barra tiene significados diferntes en función del tipo de histograma, pero en general representa la frecuencia de su clase.

* **Histograma de frecuencias absolutas:** La altura de cada bara es necesaria para que el área de la barra sea igual a la frecuencia absoluta de la clase. Las amplitudes de las clases pueden ser todas iguales o no. En el primer caso, las alturas son proporcionales a la frecuencias. En el segundo caso, no existe tal proporcionalidad a las frecuencias. En el segundo caso, no existe tal proporcionales a las frecuencias. En el segundo caso, no existe tal proporcionalidad. De todas formas, conviene indicada de alguna forma la frecuencia que representa cada barra.

* **Histograma de frecuencias relativas:** la altura, **densidad**, de cada barra es la necesaria para que el área sea igual a la frecuencia relativa de la clase, La suma de todas las areas debe ser igfual a 1.

* **Histogramas de frecuencias acumuladas:** las alturas de las barras son iguales a las frecuencias acumuladas de las clases, independientemente de su amplitud.

#### Frecuencias nulas

No es conveniente que en un histograma aparezcan clases con frecuencia nula, exceptuando el caso en que represente poblaciones muy diferentes y separadas sin individuos intermedios.

Si aparecen clases vacías, convendría utilizar un número menor de clases, o bien unir las clases vacías con alguna de sus adyacentes. De este último modo romperiamos nuestro modo de trabajar con clases de la misma amplitud.

# Dibujando histogramas con R

Lo hacemos con la función **hist**, la cual ya conocemos. Su sintaxis es:
**hist(x, breaks..., freq=..., right=...,...)**

* **x**: vector de los datos.
* **breaks**: vector con los extremos de los intervalos o el numero *k* de intervalos. Incluso podemos indicar, entre comillas, el método que deseemos para calcular el número de clases: **"Scott", "Sturges"**... Eso si, para cualquiera de las dos últimas opciones, no siempre obtendréis el número deseado de intervalos, puesto que R lo considerará solo como sugerencia. Además, recordad que el método para calcular los intervalos es diferente al de la función **cut**. Por tanto, se recomienda hacer uso de la primera opción.

* **frec=TRUE**, que es su valor por defecto, produce el histograma de frecuencias absolutas si los intervalos son todos de la misma amplitud y de frecuencias relativas en caso contrario. **freq=FALSE** nos produce siempre el de frecuencias relativas.

* **right**, funciona exactamente igual que en la función **cut**.

* **include.lowest=TRUE** también funciona exactamente igual que en la función **cut**.

* También podéis utilizar los parámetros de la función **plot** que tengan sentido.

**hist** titula por defecto los histogramas del siguiente modo: "Histogram of" seguido del nombre del vector de datos. No suele quedar muy bien si no estamos haciendo nuestro análisis en inglés.

Recordemos que el parámetro **plot** igualado a **FALSE** no dibujaba pero si calculaba el histograma.

La función **hist** contiene mucha información en su estructura interna.

* **breaks** contiene el vector de los extremos de los intervalos: $L_{1},...,L_{k+1}$.
* **mids** contiene los puntos medios de los intervalos, lo que nosotros consideramos las marcas de clase: $X_{1},...,X_{k}$
* **counts** contiene el vector de frecuencias absolutas de los intervalos: $n_{1},...,n_{k}$
* **density** contiene el vector de las densidades de los intervalos. Estas se corresponden con las alturas de las barras del histograma de frecuencias relativas. Recordemos, la densidad de un intervalo es su frecuencia relativa dividida por su amplitud.

### Función para calcular histogramas de frecuencias absolutas

```{r}
histAbs = function(x,L){
  h = hist(x, breaks = L, right = FALSE, freq =FALSE,
           xant ="n", yant="n", col= "lightgray",
           main= "Histograma de frecuencias absolutas",
           xlab = "Intervalos y marcas de clases", ylab = "Frecuencias absolutas", axis(1, at=L))
  text(h$mids, h$density/2, labels = h$counts, col ="purple")
  
}
```

* **xaxt ="n"** e **yaxt="n"** especifican que, por ahora, la función no dibuje los ejes de abcisas y ordenadas respectivamente.

* **axis(i, at=...)** dibuja el eje correspondiente al valor de *i* con marcas en los lugares indicados por el vector definido mediante **at**. Si i = 1, el de abcisas; si i = 2, el de ordenadas.

Otra forma de indicar las frecuencias absolutas de las barras es utilizar la función **rug**, la cual permite añadir al histograma una "alfombra" con marcas en todos los valores del vector, donde el grosor de cada marca es proporcional a la frecuencia del valor que representa.

Existe la posibilidad de añadir un poco de ruido a los datos de un vector para deshacer posibles empates. Esto lo conseguimos combinando la función **rug** con **jitter**.

### Función para calcular histogramas de frecuencias absolutas acumuladas más completos:

```{r}
histAbsCum = function(x,L){
  
  h =hist(x, breaks = L, right = FALSE, plot = FALSE)
  h$density = cumsum(h$density)
  plot(h, freq =FALSE, xant = "n", yant= "n",
  col ="lightgray", main ="Histograma de frecuencias\nabsolutas acumuladas", xlab= "intervalos", ylab= "Frec. absolutas acumuladas")
  axis(1, at=L)
  text(h$mids, h$density/2, labels= cumsum(h$counts), col= "purple")
  
  
  
  
}
```






